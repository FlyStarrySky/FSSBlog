<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        #hander-banner{
	    display:flex;
            //width: 100vw;
            height: 200px;
        }
	#app{
	    width:250px;
	    height:250px;
	    position: absolute;
            right: 0;
            bottom: 0;
	}
    </style>
</head>
<body>
    <div id = "hander-banner"></div>
    <div id = "app"></div>
    <script src="../Js/pixi.sj"></script>
    <script src="../Js/pixi-spine.js"></script>

    <script type="text/javascript">
        let type = "WebGL"
        if(!PIXI.utils.isWebGLSupported()){
            type = "canvas"
        }
  
        PIXI.utils.sayHello(type)
    </script>
	
    <script>	    
    //Create a Pixi Application 创建一个应用  对象
    var app = new PIXI.Application({
        //backgroundColor:0xFFFFFF,   //背景色
	transparent: true,
        autoDensity: true,
        antialias: false,
        width:250,
        height:250
    });
	    
    //Create a Pixi Application 创建一个应用  对象
    var banner = new PIXI.Application({
	//backgroundColor:0xFFFFFF,   //背景色
	antialias:true,             //抗锯齿
	transparent: true,
	//width:document.documentElement.clientWidth,
	height:200
    });
        
    //将对象显示到窗口
    //document.body.appendChild(app.view);
    document.getElementById('app').appendChild(app.view);
    document.getElementById('hander-banner').appendChild(banner.view);

    //加载Json数据
    let loader1 = PIXI.loader.add('aili','../images/aili.json')
    let loader2 = PIXI.loader.add('Serika','../images/Serika_home.json')
	    
    loader1.load((loader,res)=>{
        let aili = new PIXI.spine.Spine(res.aili.spineData),
        options = [''];
        aili.state.setAnimation(0,'idel',true);//loop你的动画名字 true 为循环播放
        aili.x = 130;
        aili.y = 250;
	aili.scale.x = 0.5;
        aili.scale.y = 0.5;
        app.stage.addChild(aili);
            
        // create new empty skin  创建新的空皮肤
        const newSkin = new PIXI.spine.core.Skin("Myskin");
            
        // add base skin  加入基础皮肤
        newSkin.addSkin(aili.spineData.findSkin("Base—戴头盔"));
            
        // add parital skins over base     加入其余皮肤
        newSkin.addSkin(aili.spineData.findSkin("皮肤/女仆服"));
        newSkin.addSkin(aili.spineData.findSkin("头饰/发饰1"));

        //设置皮肤
        aili.skeleton.setSkin(newSkin); 
        
        //Reset slots to remove not used attachments  
        aili.skeleton.setSlotsToSetupPose();
    }); 
    
    loader2.load((loader,res)=>{
	let Serika = new PIXI.spine.Spine(res.Serika.spineData),
	options = [''];
	let skeleton = Serika.skeleton;
	//获取相关骨骼
        let controlEye = skeleton.findBone('Touch_Eye')
        let controlHead = skeleton.findBone('Head')

        //眼位置
        let relative = {x: 0, y: 0}   
        //眼骨骼初始位置
        relative.x = controlEye.x
        relative.y = controlEye.y
	    
        let text1 = document.querySelector("#hander-banner")
	//过渡    
	text1.addEventListener('mouseenter',function(e){
		let j = 1
	        let timer2 = setInterval( function(){
	    	controlEye.y = controlEye.y + (-(e.clientX)/3 - controlEye.y)*(j/10)
                controlEye.x = controlEye.x + (-(e.clientY)/3 -controlEye.x)*(j/10)
		i++
		if(i===10){
			j=1
			clearInterval(timer2)
		}
	    }, 40);
	})
	//移动	
        text1.addEventListener('mousemove',function(e){
            //console.log('123');
            //console.log('眼初始位置x' + relative.x);
            //console.log('眼初始位置y' + relative.y);
	    //console.log('眼当前位置x' + controlEye.x);
            //console.log('眼当前位置y' + controlEye.y);
            //basePos.x = e.clientX
            //basePos.y = e.clientY
            //console.log(basePos.x);
	    controlEye.y = -(e.clientX - 1000)/3
            controlEye.x = -(e.clientY - 100)/3
        })
        //过渡
	text1.addEventListener('mouseleave',function(e){
	    //console.log('离开眼初始位置x' + relative.x);
            //console.log('离开眼初始位置y' + relative.y);
	    //controlEye.x = relative.x
	    //controlEye.y = relative.y
	    let i = 1
	    let timer = setInterval( function(){
	    	controlEye.y = controlEye.y - (controlEye.y - relative.y)*(i/10)
                controlEye.x = controlEye.x - (controlEye.x - relative.x)*(i/10)
		i++
		if(i===10){
			i=1
			clearInterval(timer)
		}
	    }, 40);
        })
	    Serika.state.setAnimation(0,'Idle_02',true);//loop你的动画名字 true 为循环播放
	    Serika.x = 990;
	    Serika.y = 800;
	    Serika.scale.x = 0.55;
            Serika.scale.y = 0.55;
	    banner.stage.addChild(Serika);
    }); 
	    
    let viewWidth = document.getElementById('hander-banner').clientWidth;
	    
    banner.renderer.view.style.position = "absolute";
    banner.renderer.view.style.display = "block";
    banner.renderer.autoResize = true;
    banner.renderer.resize(viewWidth, 200);
	    
    //窗体变换事件
    window.addEventListener('resize', function(){
	//console.log('1');
    	//输出当前窗口的宽
    	let windowWidth = document.documentElement.clientWidth || document.body.clientWidth;
    	//console.log(windowWidth);
	//banner.width = windowWidth;
	banner.renderer.resize(windowWidth, 200);
    });
    </script>
	
</body>
</html>
